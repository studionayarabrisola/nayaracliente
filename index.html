<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nayara Brisola | Lashe Designer</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet">

    <style>
        /* --- CONFIGURA√á√ïES GERAIS --- */
        :root {
            --cor-fundo: #f0f8ff; 
            --cor-principal: #006080; 
            --cor-clara: #4cc9f0; 
            --cor-texto: #2c3e50; 
            --branco: #ffffff;
            --cor-sucesso: #009e60; 
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(180deg, var(--cor-fundo) 0%, #ffffff 100%);
            color: var(--cor-texto);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100dvh;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        /* --- ANIMA√á√ïES --- */
        @keyframes surgirSuave { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes respirarLuz { 0%, 100% { box-shadow: 0 0 0 0 rgba(76, 201, 240, 0.4); } 50% { box-shadow: 0 0 25px 5px rgba(76, 201, 240, 0.2); } }
        @keyframes pulsarBrilho { 0%, 100% { box-shadow: 0 0 0 0 rgba(76, 201, 240, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(76, 201, 240, 0); } }
        @keyframes popModal { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes slideInRight { from { transform: translateX(50px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* --- CONTAINER PRINCIPAL --- */
        .container {
            position: relative; 
            max-width: 500px;
            width: 85%;
            text-align: center;
            background: var(--branco);
            padding: 40px 20px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0, 96, 128, 0.15);
            animation: surgirSuave 1.5s ease-out;
            margin: 20px auto;
        }

        /* --- BOT√ÉO ENTRAR / PERFIL (TOPO) --- */
        .btn-login-interno {
            position: absolute;
            top: 25px;
            left: 25px;
            z-index: 10;
            background: transparent;
            border: none;
            color: var(--cor-principal); 
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            text-align: left;
        }

        .btn-login-interno svg {
            width: 24px;
            height: 24px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2.5;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .btn-login-interno.logado { color: var(--cor-sucesso); }
        .btn-login-interno:hover { transform: translateX(2px); opacity: 0.8; }

        /* --- FOTO PERFIL --- */
        .moldura-foto {
            width: 160px;
            height: 160px;
            margin: 10px auto 20px auto; 
            border-radius: 50%;
            overflow: hidden;
            animation: respirarLuz 3s infinite ease-in-out;
            cursor: pointer;
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .moldura-foto img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            object-position: center 20%;
            border-radius: 50%; 
            border: 4px solid white; 
        }

        /* --- TEXTOS --- */
        h1 {
            font-family: 'Dancing Script', cursive;
            color: var(--cor-clara);
            font-size: 3rem;
            margin-bottom: 0px;
            line-height: 1.2;
            cursor: pointer;
        }

        h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 0.9rem;
            color: var(--cor-principal);
            margin-top: 5px;
            text-transform: uppercase;
            letter-spacing: 3px;
            font-weight: 600;
            margin-bottom: 25px;
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
        }

        .descricao { font-size: 1rem; line-height: 1.6; color: #555; margin-bottom: 35px; }

        /* --- BOT√ÉO AGENDAR --- */
        .btn-inicio {
            background: linear-gradient(90deg, var(--cor-principal) 0%, #008fb3 100%);
            color: white;
            padding: 18px 0;
            width: 100%;
            max-width: 300px;
            text-decoration: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            display: inline-block;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: transform 0.2s;
            animation: pulsarBrilho 2s infinite;
        }
        .btn-inicio:active { transform: scale(0.95); }

        footer { margin-top: 30px; font-size: 0.75rem; color: #8899a6; padding-bottom: 20px; }

        /* --- MODAL --- */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: popModal 0.4s;
        }

        .modal-login {
            background: white;
            width: 90%;
            max-width: 400px;
            padding: 30px;
            border-radius: 25px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden; 
        }

        .btn-fechar {
            position: absolute;
            top: 15px; right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #ccc;
            background: none;
            border: none;
            z-index: 20;
        }

        /* TELA LOGIN */
        .view-section { width: 100%; display: none; }
        
        .icone-login { font-size: 40px; color: var(--cor-principal); margin-bottom: 10px; }
        .titulo-login { font-size: 1.4rem; color: var(--cor-principal); font-weight: bold; margin-bottom: 20px; }
        .aviso-box {
            background-color: #e0f7fa; color: #006080;
            padding: 15px; border-radius: 12px; font-size: 0.85rem;
            margin-bottom: 25px; border-left: 4px solid var(--cor-clara);
            text-align: left; line-height: 1.4;
        }

        .btn-social {
            display: flex; align-items: center; justify-content: center;
            width: 100%; padding: 12px; border-radius: 50px;
            margin-bottom: 15px; font-size: 0.95rem; font-weight: 600;
            cursor: pointer; transition: transform 0.2s; border: 2px solid #eee;
            background: white; color: #555; gap: 10px;
        }
        .btn-social:active { transform: scale(0.98); }
        .btn-google img { width: 20px; }
        .btn-email { background-color: var(--cor-principal); color: white; border: none; }

        /* TELA FORMUL√ÅRIO (EMAIL) */
        #viewEmail { animation: slideInRight 0.3s ease-out; }
        .btn-voltar-modal {
            position: absolute; top: 20px; left: 20px;
            background: none; border: 1px solid #eee; border-radius: 20px;
            color: var(--cor-principal); padding: 5px 15px; font-size: 0.8rem;
            cursor: pointer; font-weight: 600;
        }
        .input-custom {
            width: 100%; padding: 14px 20px; margin-bottom: 15px;
            border: 1px solid #ddd; border-radius: 25px;
            font-size: 0.95rem; box-sizing: border-box; background-color: #fcfcfc;
        }
        .btn-entrar-form {
            width: 100%; padding: 14px; background-color: var(--cor-principal);
            color: white; border: none; border-radius: 25px;
            font-size: 1rem; font-weight: bold; cursor: pointer;
        }

        /* TELA LOGADO */
        #viewLogged { animation: slideInRight 0.3s ease-out; }
        .perfil-foto-area {
            width: 80px; height: 80px;
            border-radius: 50%;
            margin: 0 auto 10px auto;
            background-color: #eee;
            overflow: hidden;
        }
        .perfil-foto-area img { width: 100%; height: 100%; object-fit: cover; }
        
        .lista-agendamentos {
            text-align: left; max-height: 300px; overflow-y: auto;
            margin-bottom: 25px; padding-right: 5px;
        }
        .item-agendamento {
            background: #f9f9f9; border-left: 4px solid var(--cor-clara);
            padding: 12px; margin-bottom: 10px; border-radius: 8px; font-size: 0.9rem;
            display: flex; justify-content: space-between; align-items: center;
        }
        .btn-sair {
            background-color: #ffebee; color: #d32f2f; border: none;
            padding: 12px 30px; border-radius: 25px; font-weight: bold;
            cursor: pointer; width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="container">
        <button id="btnEntrar" class="btn-login-interno" onclick="abrirLogin()">
            <svg viewBox="0 0 24 24"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path><polyline points="10 17 15 12 10 7"></polyline><line x1="15" y1="12" x2="3" y2="12"></line></svg>
            Entrar
        </button>
        
        <div class="moldura-foto">
            <img src="petista.jpg" alt="Logo">
        </div>

        <h1>Nayara Brisola</h1>
        <h2>Lashe Designer</h2>

        <div class="descricao">
            <p>Realce o seu olhar com t√©cnicas exclusivas de <strong>Volume Brasileiro</strong> e <strong>Design de Sobrancelhas</strong>.</p>
        </div>

        <a href="#" onclick="verificarLogin()" class="btn-inicio">Agendar Hor√°rio</a>
    </div>

    <footer>&copy; 2025 Nayara Brisola</footer>

    <div id="modalLogin" class="modal-overlay">
        <div class="modal-login">
            <button class="btn-fechar" onclick="fecharLogin()">&times;</button>
            
            <div id="viewSocial" class="view-section">
                <div class="icone-login">üîê</div>
                <div class="titulo-login">√Årea do Cliente</div>
                <div class="aviso-box">
                    <strong>Aten√ß√£o:</strong><br>
                    Fa√ßa login para agendar.
                </div>

                <button class="btn-social btn-google" onclick="fazerLoginGoogle()">
                    <svg width="20" height="20" viewBox="0 0 48 48">
                        <path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path>
                        <path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path>
                        <path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path>
                        <path fill="#1976D2" d="M43.611,20.083L43.611,20.083C43.862,21.35,44,22.659,44,24c0,5.61-2.066,10.875-5.591,14.808l-6.19-5.238C33.21,32.571,34.025,31.309,34.591,29.897C35.842,26.791,36,23.473,34.996,20.083H43.611z"></path>
                    </svg>
                    Entrar com Google
                </button>

                <button class="btn-social btn-email" onclick="mostrarFormulario()">Continuar com Email</button>
            </div>

            <div id="viewEmail" class="view-section">
                <button class="btn-voltar-modal" onclick="mostrarSocial()">‚Üê Voltar</button>
                <div class="marca-login">Nayara Brisola</div>
                <input type="email" id="emailInput" class="input-custom" placeholder="exemplo@gmail.com">
                <input type="password" id="senhaInput" class="input-custom" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                <button class="btn-entrar-form" onclick="alert('Use o Google!')">Entrar</button>
            </div>

            <div id="viewLogged" class="view-section">
                <div class="perfil-foto-area">
                    <img id="imgPerfilUsuario" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="Perfil">
                </div>
                <div class="titulo-login" id="nomeUsuarioLogado">Carregando...</div>
                
                <h3 style="color:#006080; font-size:1rem; margin-bottom:15px; border-bottom:1px solid #eee;">
                    Seus Agendamentos
                </h3>
                <div class="lista-agendamentos" id="containerAgendamentos"></div>
                <button class="btn-sair" onclick="fazerLogout()">Sair da Conta</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        // Importamos AMBOS: Redirect (para mobile) e Popup (para PC)
        import { getAuth, GoogleAuthProvider, signInWithPopup, signInWithRedirect, getRedirectResult, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCLkHAL6V4xwfuLJbRYhnZcIAWRo6D2c1M",
            authDomain: "agendanayara-e900b.firebaseapp.com",
            projectId: "agendanayara-e900b",
            storageBucket: "agendanayara-e900b.firebasestorage.app",
            messagingSenderId: "306081027760",
            appId: "1:306081027760:web:0cbdac4448e2672069cd75"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();
        auth.languageCode = 'pt';

        const isMobileDevice = () => {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        };

        console.log("üî• Firebase ON. Modo Mobile:", isMobileDevice());

        // --- 1. FUN√á√ÉO H√çBRIDA DE LOGIN ---
        window.fazerLoginGoogle = async () => {
            const btnGoogle = document.querySelector('.btn-google');
            if (btnGoogle) {
                btnGoogle.innerHTML = `<div style="width:16px;height:16px;border:2px solid #555;border-radius:50%;border-top-color:transparent;animation:spin 1s linear infinite;margin-right:8px;"></div> Processando...`;
                btnGoogle.disabled = true;
            }

            try {
                if (isMobileDevice()) {
                    // MODO MOBILE: Usa REDIRECT (resolve o problema do "conectando" infinito)
                    // Marcamos que o usu√°rio tentou logar
                    sessionStorage.setItem('loginEmAndamento', 'true');
                    console.log("üì± Mobile detectado. Usando Redirect...");
                    await signInWithRedirect(auth, provider);
                    // A p√°gina vai recarregar sozinha, n√£o faz mais nada aqui.
                } else {
                    // MODO PC: Usa POPUP (mais fluido)
                    console.log("üíª PC detectado. Usando Popup...");
                    const result = await signInWithPopup(auth, provider);
                    console.log("‚úÖ Login PC Sucesso:", result.user.displayName);
                    fecharLogin(); // O monitor de estado atualiza a tela
                }
            } catch (error) {
                console.error("‚ùå Erro no Login:", error);
                if (btnGoogle) {
                    btnGoogle.innerHTML = 'Tentar Google Novamente';
                    btnGoogle.disabled = false;
                }
                alert("Erro ao conectar: " + error.message);
            }
        };

        // --- 2. RECUPERA√á√ÉO DO LOGIN AP√ìS REDIRECT (MOBILE) ---
        window.addEventListener('load', async () => {
            // S√≥ executa se estivermos esperando um login (para economizar recursos)
            const loginPendente = sessionStorage.getItem('loginEmAndamento');
            
            if (loginPendente) {
                console.log("üîÑ Verificando retorno do Google (Redirect)...");
                try {
                    const result = await getRedirectResult(auth);
                    
                    if (result) {
                        console.log("‚úÖ Login Mobile Confirmado!");
                        sessionStorage.removeItem('loginEmAndamento');
                        // O onAuthStateChanged vai cuidar da tela
                    } else {
                        // Se caiu aqui, o Google voltou mas sem usu√°rio. 
                        // 99% das vezes √© porque o dom√≠nio n√£o est√° autorizado.
                        console.warn("‚ö†Ô∏è Retorno vazio.");
                        sessionStorage.removeItem('loginEmAndamento');
                        alert("‚ö†Ô∏è O login falhou silenciosamente.\n\nPor favor, verifique se o link 'studionayarabrisola.github.io' foi adicionado em 'Authorized Domains' no painel do Firebase.");
                    }
                } catch (error) {
                    console.error("Erro no retorno:", error);
                    sessionStorage.removeItem('loginEmAndamento');
                    alert("Falha no login: " + error.message);
                }
            }
        });

        // --- 3. MONITOR GERAL DE ESTADO ---
        onAuthStateChanged(auth, (user) => {
            const btnHome = document.getElementById('btnEntrar');
            if (!btnHome) return;

            if (user) {
                console.log("üë§ Logado:", user.email);
                btnHome.innerHTML = `<span style="color:#009e60">Ol√°, ${user.displayName ? user.displayName.split(' ')[0] : 'Cliente'}</span>`;
                btnHome.classList.add('logado');
                
                // Se modal estiver aberto, mostra perfil
                if(document.getElementById('modalLogin').style.display === 'flex') {
                    mostrarPerfil(user);
                }
            } else {
                console.log("üë§ Deslogado");
                btnHome.innerHTML = `<svg viewBox="0 0 24 24"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path><polyline points="10 17 15 12 10 7"></polyline><line x1="15" y1="12" x2="3" y2="12"></line></svg> Entrar`;
                btnHome.classList.remove('logado');
                mostrarSocial();
            }
        });

        // --- RESTANTE DA UI (Logout, Mostrar Perfil, etc) ---
        window.fazerLogout = async () => {
            if(confirm("Sair da conta?")) {
                await signOut(auth);
                window.location.reload();
            }
        };

        window.abrirLogin = () => { 
            document.getElementById('modalLogin').style.display = 'flex'; 
            if(!auth.currentUser) mostrarSocial();
            else mostrarPerfil(auth.currentUser);
        };
        window.fecharLogin = () => { document.getElementById('modalLogin').style.display = 'none'; };
        window.mostrarSocial = () => { 
            document.getElementById('viewLogged').style.display = 'none';
            document.getElementById('viewSocial').style.display = 'block'; 
            document.getElementById('viewEmail').style.display = 'none';
        };
        window.mostrarFormulario = () => {
             document.getElementById('viewSocial').style.display = 'none'; 
             document.getElementById('viewEmail').style.display = 'block';
        };
        window.verificarLogin = () => {
            if(auth.currentUser) window.location.href = 'servicos.html';
            else abrirLogin();
        };

        async function mostrarPerfil(user) {
            document.getElementById('viewSocial').style.display = 'none';
            document.getElementById('viewLogged').style.display = 'block';
            document.getElementById('nomeUsuarioLogado').innerText = user.displayName || "Cliente";
            if(user.photoURL) document.getElementById('imgPerfilUsuario').src = user.photoURL;

            // Busca Agendamentos
            const lista = document.getElementById('containerAgendamentos');
            lista.innerHTML = 'Buscando...';
            try {
                const q = query(collection(db, "agendamentos"), where("uid", "==", user.uid));
                const snap = await getDocs(q);
                lista.innerHTML = '';
                if(snap.empty) lista.innerHTML = '<div style="text-align:center;padding:10px;color:#888">Nenhum agendamento.</div>';
                snap.forEach(doc => {
                    const d = doc.data();
                    lista.innerHTML += `<div class="item-agendamento"><div><b>${d.data}</b> - ${d.hora}<br><small>${d.servico}</small></div><span style="color:green">Confirmado</span></div>`;
                });
            } catch(e) { lista.innerHTML = 'Erro ao buscar.'; }
        }
    </script>
</body>
</html>
